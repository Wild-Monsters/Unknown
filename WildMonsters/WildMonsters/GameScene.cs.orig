using System;
using System.Collections.Generic;

using Sce.PlayStation.Core;
using Sce.PlayStation.Core.Environment;
using Sce.PlayStation.Core.Graphics;
using Sce.PlayStation.Core.Input;
using Sce.PlayStation.Core.Audio;

using Sce.PlayStation.HighLevel.GameEngine2D;
using Sce.PlayStation.HighLevel.GameEngine2D.Base;


namespace WildMonsters
{
	public class GameScene : Scene
	{
		private GridProperties grid1Props, grid2Props;
		private LevelGrid grid1, grid2;
		private LevelUI levelUI;
		
		private float top = 960/2;
		
		private Player player1;
		private Player player2;
		// Fyring blocks
		
		
		public GameScene()
		{
			this.Camera.SetViewFromViewport ();
			Scheduler.Instance.ScheduleUpdateForTarget(this, 1, false);

			InitialiseGrids ();
			levelUI = new LevelUI(this);
			
			grid1.Draw (this);
			grid2.Draw (this);
			
			player1 = new Player(this, true);
			player2 = new Player(this, false);
		}

		private void InitialiseGrids()
		{
<<<<<<< HEAD
			grid1Properties = new GridProperties();
			grid1Properties.height = 10;
			grid1Properties.width = 20;
			grid1Properties.cellSize = 50;
			grid1Properties.flipped = true;
			grid1Properties.xMargin = 50.0f;
			grid1Properties.yMargin = 0.0f;
			grid1Properties.top = 960.0f/2;
			grid1Properties.startRows = 3;
			
			grid2Properties = new GridProperties();
			grid2Properties.height = 10;
			grid2Properties.width = 20;
			grid2Properties.cellSize = 50;
			grid2Properties.flipped = false;
			grid2Properties.xMargin = 50.0f;
			grid2Properties.yMargin = 0.0f;
			grid2Properties.top = 960.0f/2;
			grid2Properties.startRows = 3;
			
			grid1 = new LevelGrid(grid1Properties);
			grid2 = new LevelGrid(grid2Properties);
=======
			grid1Props = new GridProperties();
			grid1Props.height = 10;
			grid1Props.width = 3;
			grid1Props.cellSize = 50;
			grid1Props.flipped = true;
			grid1Props.xMargin = 50.0f;
			grid1Props.yMargin = 0.0f;
			grid1Props.top = 960.0f/2;
			grid1Props.startRows = 3;
			
			grid2Props = new GridProperties();
			grid2Props.height = 10;
			grid2Props.width = 3;
			grid2Props.cellSize = 50;
			grid2Props.flipped = false;
			grid2Props.xMargin = 50.0f;
			grid2Props.yMargin = 0.0f;
			grid2Props.top = 960.0f/2;
			grid2Props.startRows = 3;
			
			grid1 = new LevelGrid(grid1Props);
			grid2 = new LevelGrid(grid2Props);
>>>>>>> d3553b5d0ea3d1ca079e8d74d083ee63014182fe
		}

		public override void Update(float t)
		{
			UpdateTop (t);

			player1.Update (this);
			player2.Update (this);
			levelUI.Update (t);
			grid1.Update (t);
			grid2.Update (t);
			
		}
		
		private void UpdateTop(float t)
		{
			if(Input.KeyPressed (GamePadButtons.Right))
				top += 50.0f;
			
			if(Input.KeyPressed (GamePadButtons.Left))
<<<<<<< HEAD
				topTarget -= 50.0f;
			
			
			if(top < topTarget)
				top += FMath.Clamp ((topTarget-top)/divSpeed,0.5f,10.0f);
			
			
			if(top > topTarget)
				top -= FMath.Clamp ((top-topTarget)/divSpeed,0.5f,10.0f);
			
			top = FMath.Floor (top);
			///////////
			///////////
			
			player1.Update (this);
			player2.Update (this);
=======
				top -= 50.0f;
>>>>>>> d3553b5d0ea3d1ca079e8d74d083ee63014182fe
			
			levelUI.divider.SetTop (top);
			
			grid1.SetTop (top);
			grid2.SetTop (top);
<<<<<<< HEAD
			
			grid1.Update (deltaTime);
			grid2.Update (deltaTime);
			
			//Collision Stuff trial 
			CollisionHandler.CheckBlockCollision(player1.getBalls(), grid1);
			CollisionHandler.CheckBlockCollision(player2.getBalls(), grid2);
=======
>>>>>>> d3553b5d0ea3d1ca079e8d74d083ee63014182fe
		}
		

		
	}
}